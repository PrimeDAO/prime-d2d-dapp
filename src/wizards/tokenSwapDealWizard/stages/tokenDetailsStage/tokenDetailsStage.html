<template>
  <require from="../../components/stageWrapper/stageWrapper"></require>
  <require from="../../components/tokenDetails/tokenDetails"></require>
  <stage-wrapper
    header="Token details"
    wizard-manager.bind="wizardManager">

    <div class="stageSection" data-test="primary-dao-tokens">
      <div class="stageSectionSidebar">
        <h2 class="sidebarHeader heading heading3 title">
          <template if.bind="isOpenProposalWizard">Tokens</template>
          <template else>Primary DAO Tokens</template>
        </h2>
        <p class="sidebarText">
          Please fill in the Ethereum native token address and swapping details of the primary DAO.
        </p>
      </div>
      <div class="stageSectionContent">
        <token-details
          repeat.for="token of wizardState.registrationData.primaryDAO.tokens"
          on-delete.call="deleteToken(token, wizardState.registrationData.primaryDAO.tokens, primaryDAOTokenDetails)"
          on-saved.call="checkedForUnsavedChanges()"
          view-mode.bind="stageMetadata.primaryDAOTokenDetailsViewModes[$index]"
          token.bind="token"
          view-model.ref="primaryDAOTokenDetails[$index]"
          wizard-type.bind="wizardType"
          hide-delete-button.bind="wizardState.registrationData.primaryDAO.tokens.length === 1"
        ></token-details>

        <pbutton class="addTokenButton" click.delegate="addToken(wizardState.registrationData.primaryDAO.tokens)"
                 if.bind="wizardState.registrationData.primaryDAO.tokens.length < 2"
                 type="primary">
          Add token
          <i class="fa fa-plus"></i>
        </pbutton>

        <p
          class="feedbackMessage errorMessage ${!hasValidPrimaryDAOTokensDetailsCount ? 'feedbackMessageVisible' : ''}">
          A partnered deal needs to have at least one saved token detail
        </p>

        <p class="feedbackMessage errorMessage ${hasUnsavedChangesForPrimaryDetails ? 'feedbackMessageVisible' : ''}">
          Please save your token details
        </p>
      </div>
    </div>

    <div class="stageSection" if.bind="!isOpenProposalWizard">
      <div class="stageSectionSidebar">
        <h2 class="sidebarHeader heading heading3 title">Partner DAO Tokens</h2>
        <p class="sidebarText">
          Please fill in the Ethereum native token address and swapping details of the secondary DAO.
        </p>
      </div>

      <div class="stageSectionContent">
        <token-details
          repeat.for="token of wizardState.registrationData.partnerDAO.tokens"
          on-delete.call="deleteToken(token, wizardState.registrationData.partnerDAO.tokens, partnerDAOTokenDetails)"
          on-saved.call="checkedForUnsavedChanges()"
          view-mode.bind="stageMetadata.partnerDAOTokenDetailsViewModes[$index]"
          token.bind="token"
          view-model.ref="partnerDAOTokenDetails[$index]"
          hide-delete-button.bind="wizardState.registrationData.partnerDAO.tokens.length === 1"
        ></token-details>

        <pbutton class="addTokenButton" click.delegate="addToken(wizardState.registrationData.partnerDAO.tokens)"
                 if.bind="wizardState.registrationData.partnerDAO.tokens.length < 2"
                 type="primary">
          Add token
          <i class="fa fa-plus"></i>
        </pbutton>

        <p class="feedbackMessage errorMessage ${!hasValidPartnerDAOTokensDetailsCount? 'feedbackMessageVisible' : ''}">
          A partnered deal needs to have at least one saved token detail
        </p>
        <p class="feedbackMessage errorMessage ${hasUnsavedChangesForPartnerDetails ? 'feedbackMessageVisible' : ''}">
          Please save your token details
        </p>
      </div>
    </div>

    <div class="stageSection">
      <div class="stageSectionSidebar">
        <h2 class="sidebarHeader heading heading3 title">Execution Period</h2>
        <p class="sidebarText">
          After both parties have discussed and agreed on the deal clauses they should be ready to fully fund the deal and execute the swap on-chain.
        </p>
        <br>
        <p class="sidebarText">
          Here you can setup the non-extendable amount of days that both parties have to complete these actions. If the representatives and the proposal lead failed to that within this agreed upon timeframe, the deal is considered Failed.
        </p>
        <br>
        <p class="sidebarText">
          With all of this mind, make sure that you set a reasonable Execution Period that takes in consideration the time needed to pass the deals through the governance processes of both parties.
        </p>
      </div>
      <div class="stageSectionContent">
        <pform-input
          class="wizardFormInput"
          input-reference.bind="executionPeriodInput"
          label="On-Chain Execution Period"
          data-test="proposal-execution-period-field">
          <pinput-group>
            <pinput-numeric
              not-wei
              value.bind="wizardState.registrationData.executionPeriodInDays | secondsDays & validate:form"
              view-model.ref="executionPeriodInput"></pinput-numeric>
            <span slot="after">days</span>
          </pinput-group>
        </pform-input>

      </div>
    </div>

  </stage-wrapper>
</template>
